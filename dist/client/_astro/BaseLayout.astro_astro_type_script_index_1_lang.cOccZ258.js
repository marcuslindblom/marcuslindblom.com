const L="modulepreload",_=function(n){return"/"+n},v={},S=function(e,t,a){let s=Promise.resolve();if(t&&t.length>0){let i=function(o){return Promise.all(o.map(m=>Promise.resolve(m).then(h=>({status:"fulfilled",value:h}),h=>({status:"rejected",reason:h}))))};document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),y=c?.nonce||c?.getAttribute("nonce");s=i(t.map(o=>{if(o=_(o),o in v)return;v[o]=!0;const m=o.endsWith(".css"),h=m?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${o}"]${h}`))return;const d=document.createElement("link");if(d.rel=m?"stylesheet":L,m||(d.as="script"),d.crossOrigin="",d.href=o,y&&d.setAttribute("nonce",y),document.head.appendChild(d),m)return new Promise((C,k)=>{d.addEventListener("load",C),d.addEventListener("error",()=>k(new Error(`Unable to preload CSS for ${o}`)))})}))}function r(i){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=i,window.dispatchEvent(c),!c.defaultPrevented)throw i}return s.then(i=>{for(const c of i||[])c.status==="rejected"&&r(c.reason);return e().catch(r)})};class l extends MessageChannel{static _instanceCache;static get instance(){return this._instanceCache||(this._instanceCache=new l),this._instanceCache}invoke(){switch(this.port1.addEventListener("message",e=>{e.data.cmd===1&&this.onConnected(e)},{once:!0}),this.port1.start(),this._ready=new Promise((e,t)=>{this.readyResolve=e,this.readyReject=t}),this._ready.then(()=>{console.log(`SENDING HSHK FROM SDK IN WINDOW ${window.name}`),window.top.postMessage({cmd:2,context:{name:window.name,height:document.body.scrollHeight}},"*",[this.port2])}),document.readyState){case"loading":case"interactive":document.onreadystatechange=()=>{document.readyState==="complete"&&this.readyResolve()};break;case"complete":this.readyResolve()}}constructor(){super(),this.broadcastChannel=new BroadcastChannel("app.broadcast")}subscribe(e){if(typeof e!="function")throw new Error("messageHandler must be a function!");const t=s=>{try{e(s)}catch(r){console.error("Error in messageHandler:",r)}},a=s=>{try{this.broadcastChannel.postMessage(s.data)}catch(r){console.error("Error in messageHandler:",r)}};return this.broadcastChannel.addEventListener("message",t),this.port1.addEventListener("message",t),this.port1.addEventListener("message",a),()=>{console.log("unsubscribing "+window.name),this.broadcastChannel.removeEventListener("message",t),this.port1.removeEventListener("message",t),this.port1.removeEventListener("message",a),this.port1.close(),l._instanceCache=null}}send(e){this.port1.postMessage(e),this.broadcastChannel.postMessage(e)}onConnected(e){return e}}const w=(n,e)=>n?.split(".").reduce((t,a)=>t?.[a],e),x=4,N=8,E=32;let p=!1,g={},b={},f=[];const u=[],P=({data:n})=>{try{n.cmd===8&&n.sync.forEach(e=>{if(e.currentPath===window.location.pathname)switch(e.action){case N:u.forEach(({self:a,handler:s})=>{const r=(e.data.placeholders??[]).find(i=>i.propertyName===a.dataset.field);r&&(a.dataset.placeholder=r.placeholder)}),f=[...e.data?.placeholder??[]];break;case E:const t=e.data?.change;t?u.forEach(({self:a,handler:s})=>{t.name===a.dataset.field&&s(t.value,e.context)}):e.data?.state&&u.forEach(({self:a,handler:s})=>{const r=w(a.dataset.field,e.data.state);r!==void 0&&s(r,e.context)}),e.data?.state&&(g={...e.data.state},p=!0),e.context&&(b={...e.context})}})}catch(e){console.error(e)}},R=(n,e)=>{if(u.push({self:n,handler:e}),p){const t=w(n.dataset.field,g);t!==void 0&&e(t,b)}if(f.length){const t=f.find(a=>a.propertyName===n.dataset.field);t&&(n.dataset.placeholder=t.placeholder||"")}},M=n=>{if(typeof n!="function")throw new Error("messageHandler must be a function!");return p&&n(g),l.instance.subscribe(e=>{try{if(e.data.cmd===8)for(const t of e.data.sync)t.action!==E||n(t.data.state)}catch(t){console.error("Error in messageHandler:",t)}})},H=()=>{const n=((e,t)=>{let a;return function(...s){clearTimeout(a),a=setTimeout(()=>e.apply(this,s),t)}})(()=>{l.instance.send({cmd:4,updates:[{action:x,context:{name:window.name,height:document.body.scrollHeight}}]})},100);new ResizeObserver(e=>{for(let t of e)t.target===document.body&&n()}).observe(document.body)};typeof document<"u"&&document.addEventListener("DOMContentLoaded",n=>{performance.mark("mark-2"),performance.measure("Import elements started","mark-1","mark-2"),console.debug(`${performance.now().toFixed(1)}ms: [${window.name}] Import elements started after ${performance.getEntriesByName("Import elements started")[0].duration.toFixed(1)}ms`),S(()=>import("./index-5a5f910d.-ZjCxU7P.js"),[]),l.instance.invoke(),l.instance.subscribe(P),H()}),performance.mark("mark-1");export{M as g,w as o,R as u};
