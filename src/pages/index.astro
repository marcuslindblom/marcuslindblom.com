---
import BaseLayout from '../layouts/BaseLayout.astro';
import Header from '../components/landing/Header.astro';
import Content from '../components/landing/Content.astro';
import store from '../store';
import '../array-polyfills'

const session = store.openSession();

const homeLazy = session
  .query({ indexName: 'Content/ByUrl' })
  .whereEquals('url', '/')
  .lazily();

const notesLazy = session
  .query({ indexName: 'Content/ByUrl' })
  .whereEquals('collection', 'posts')
  .whereEquals('published', true)
  .orderByDescending('publishedDate')
  .selectFields(['heading', 'summary', 'publishedDate', 'url'])
  .take(3)
  .lazily();

const { home, notes } = await Promise.all([homeLazy.getValue(), notesLazy.getValue()]).then(([home, notes]) => {
    return {
      home: home.firstOrDefault(),
      notes: notes
    }
  });
---

<BaseLayout>
  <Header
    heading={home.heading}
    introduction={home.introduction}
    avatar={home.avatar}
  />
  <Content notes={notes} />
</BaseLayout>
